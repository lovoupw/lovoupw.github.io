<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content="负重前行，O52O加油吧少年"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>JavaScript 教程-浏览器模型-表单，FormData 对象 | O52O</title>

<link rel="shortcut icon" href="https://0520.eu.org/favicon.ico?v=1726225545706">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://0520.eu.org/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            O52O
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
                <div class="nav-item">
                    
                        <a href="/" class="menu gt-a-link">
                            首页
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/post/javascript" class="menu gt-a-link">
                            Javascript
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/archives" class="menu gt-a-link">
                            归档
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/tags" class="menu gt-a-link">
                            标签
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/friends" class="menu gt-a-link">
                            友链
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/post/about" class="menu gt-a-link">
                            关于
                        </a>
                    
                </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1726225545706" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    JavaScript 教程-浏览器模型-表单，FormData 对象
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2024-05-31 ·
                    </time>
                    
                        <a href="https://0520.eu.org/tag/G-9IdbXM1/" class="post-tags">
                            # JavaScript 教程
                        </a>
                    
                </div>
                <div class="post-content">
                    <p><ul class="markdownIt-TOC">
<li><a href="#%E8%A1%A8%E5%8D%95formdata-%E5%AF%B9%E8%B1%A1">表单，FormData 对象</a>
<ul>
<li><a href="#%E8%A1%A8%E5%8D%95%E6%A6%82%E8%BF%B0">表单概述</a></li>
<li><a href="#formdata-%E5%AF%B9%E8%B1%A1">FormData 对象</a>
<ul>
<li><a href="#%E6%A6%82%E8%BF%B0">概述</a></li>
<li><a href="#%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95">实例方法</a></li>
</ul>
</li>
<li><a href="#%E8%A1%A8%E5%8D%95%E7%9A%84%E5%86%85%E7%BD%AE%E9%AA%8C%E8%AF%81">表单的内置验证</a>
<ul>
<li><a href="#%E8%87%AA%E5%8A%A8%E6%A0%A1%E9%AA%8C">自动校验</a></li>
<li><a href="#checkvalidity">checkValidity()</a></li>
<li><a href="#willvalidate-%E5%B1%9E%E6%80%A7">willValidate 属性</a></li>
<li><a href="#validationmessage-%E5%B1%9E%E6%80%A7">validationMessage 属性</a></li>
<li><a href="#setcustomvalidity">setCustomValidity()</a></li>
<li><a href="#validity-%E5%B1%9E%E6%80%A7">validity 属性</a></li>
<li><a href="#%E8%A1%A8%E5%8D%95%E7%9A%84-novalidate-%E5%B1%9E%E6%80%A7">表单的 novalidate 属性</a></li>
</ul>
</li>
<li><a href="#enctype-%E5%B1%9E%E6%80%A7">enctype 属性</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">文件上传</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5">参考链接</a></li>
</ul>
</li>
</ul>
</p>
<h1 id="表单formdata-对象">表单，FormData 对象</h1>
<h2 id="表单概述">表单概述</h2>
<p>表单（<code>&lt;form&gt;</code>）用来收集用户提交的数据，发送到服务器。比如，用户提交用户名和密码，让服务器验证，就要通过表单。表单提供多种控件，让开发者使用，具体的控件种类和用法请参考 HTML 语言的教程。本章主要介绍 JavaScript 与表单的交互。</p>
<!-- more -->
<pre><code class="language-html">&lt;form action=&quot;/handling-page&quot; method=&quot;post&quot;&gt;
  &lt;div&gt;
    &lt;label for=&quot;name&quot;&gt;用户名：&lt;/label&gt;
    &lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;user_name&quot; /&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;label for=&quot;passwd&quot;&gt;密码：&lt;/label&gt;
    &lt;input type=&quot;password&quot; id=&quot;passwd&quot; name=&quot;user_passwd&quot; /&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;input type=&quot;submit&quot; id=&quot;submit&quot; name=&quot;submit_button&quot; value=&quot;提交&quot; /&gt;
  &lt;/div&gt;
&lt;/form&gt;
</code></pre>
<p>上面代码就是一个简单的表单，包含三个控件：用户名输入框、密码输入框和提交按钮。</p>
<p>用户点击“提交”按钮，每一个控件都会生成一个键值对，键名是控件的<code>name</code>属性，键值是控件的<code>value</code>属性，键名和键值之间由等号连接。比如，用户名输入框的<code>name</code>属性是<code>user_name</code>，<code>value</code>属性是用户输入的值，假定是“张三”，提交到服务器的时候，就会生成一个键值对<code>user_name=张三</code>。</p>
<p>所有的键值对都会提交到服务器。但是，提交的数据格式跟<code>&lt;form&gt;</code>元素的<code>method</code>属性有关。该属性指定了提交数据的 HTTP 方法。如果是 GET 方法，所有键值对会以 URL 的查询字符串形式，提交到服务器，比如<code>/handling-page?user_name=张三&amp;user_passwd=123&amp;submit_button=提交</code>。下面就是 GET 请求的 HTTP 头信息。</p>
<pre><code class="language-http">GET /handling-page?user_name=张三&amp;user_passwd=123&amp;submit_button=提交
Host: example.com
</code></pre>
<p>如果是 POST 方法，所有键值对会连接成一行，作为 HTTP 请求的数据体发送到服务器，比如<code>user_name=张三&amp;user_passwd=123&amp;submit_button=提交</code>。下面就是 POST 请求的头信息。</p>
<pre><code class="language-http">POST /handling-page HTTP/1.1
Host: example.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 74

user_name=张三&amp;user_passwd=123&amp;submit_button=提交
</code></pre>
<p>注意，实际提交的时候，只要键值不是 URL 的合法字符（比如汉字“张三”和“提交”），浏览器会自动对其进行编码。</p>
<p>点击<code>submit</code>控件，就可以提交表单。</p>
<pre><code class="language-html">&lt;form&gt;
  &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;
&lt;/form&gt;
</code></pre>
<p>上面表单就包含一个<code>submit</code>控件，点击这个控件，浏览器就会把表单数据向服务器提交。</p>
<p>注意，表单里面的<code>&lt;button&gt;</code>元素如果没有用<code>type</code>属性指定类型，那么默认就是<code>submit</code>控件。</p>
<pre><code class="language-html">&lt;form&gt;
  &lt;button&gt;提交&lt;/button&gt;
&lt;/form&gt;
</code></pre>
<p>上面表单的<code>&lt;button&gt;</code>元素，点击以后也会提交表单。</p>
<p>除了点击<code>submit</code>控件提交表单，还可以用表单元素的<code>submit()</code>方法，通过脚本提交表单。</p>
<pre><code class="language-javascript">formElement.submit();
</code></pre>
<p>表单元素的<code>reset()</code>方法可以重置所有控件的值（重置为默认值）。</p>
<pre><code class="language-javascript">formElement.reset()
</code></pre>
<h2 id="formdata-对象">FormData 对象</h2>
<h3 id="概述">概述</h3>
<p>表单数据以键值对的形式向服务器发送，这个过程是浏览器自动完成的。但是有时候，我们希望通过脚本完成这个过程，构造或编辑表单的键值对，然后通过脚本发送给服务器。浏览器原生提供了 FormData 对象来完成这项工作。</p>
<p><code>FormData()</code>首先是一个构造函数，用来生成表单的实例。</p>
<pre><code class="language-javascript">var formdata = new FormData(form);
</code></pre>
<p><code>FormData()</code>构造函数的参数是一个 DOM 的表单元素，构造函数会自动处理表单的键值对。这个参数是可选的，如果省略该参数，就表示一个空的表单。</p>
<p>下面是一个表单。</p>
<pre><code class="language-html">&lt;form id=&quot;myForm&quot; name=&quot;myForm&quot;&gt;
  &lt;div&gt;
    &lt;label for=&quot;username&quot;&gt;用户名：&lt;/label&gt;
    &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;label for=&quot;useracc&quot;&gt;账号：&lt;/label&gt;
    &lt;input type=&quot;text&quot; id=&quot;useracc&quot; name=&quot;useracc&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;label for=&quot;userfile&quot;&gt;上传文件：&lt;/label&gt;
    &lt;input type=&quot;file&quot; id=&quot;userfile&quot; name=&quot;userfile&quot;&gt;
  &lt;/div&gt;
&lt;input type=&quot;submit&quot; value=&quot;Submit!&quot;&gt;
&lt;/form&gt;
</code></pre>
<p>我们用<code>FormData()</code>处理上面这个表单。</p>
<pre><code class="language-javascript">var myForm = document.getElementById('myForm');
var formData = new FormData(myForm);

// 获取某个控件的值
formData.get('username') // &quot;&quot;

// 设置某个控件的值
formData.set('username', '张三');

formData.get('username') // &quot;张三&quot;
</code></pre>
<h3 id="实例方法">实例方法</h3>
<p>FormData 提供以下实例方法。</p>
<ul>
<li><code>FormData.get(key)</code>：获取指定键名对应的键值，参数为键名。如果有多个同名的键值对，则返回第一个键值对的键值。</li>
<li><code>FormData.getAll(key)</code>：返回一个数组，表示指定键名对应的所有键值。如果有多个同名的键值对，数组会包含所有的键值。</li>
<li><code>FormData.set(key, value)</code>：设置指定键名的键值，参数为键名。如果键名不存在，会添加这个键值对，否则会更新指定键名的键值。如果第二个参数是文件，还可以使用第三个参数，表示文件名。</li>
<li><code>FormData.delete(key)</code>：删除一个键值对，参数为键名。</li>
<li><code>FormData.append(key, value)</code>：添加一个键值对。如果键名重复，则会生成两个相同键名的键值对。如果第二个参数是文件，还可以使用第三个参数，表示文件名。</li>
<li><code>FormData.has(key)</code>：返回一个布尔值，表示是否具有该键名的键值对。</li>
<li><code>FormData.keys()</code>：返回一个遍历器对象，用于<code>for...of</code>循环遍历所有的键名。</li>
<li><code>FormData.values()</code>：返回一个遍历器对象，用于<code>for...of</code>循环遍历所有的键值。</li>
<li><code>FormData.entries()</code>：返回一个遍历器对象，用于<code>for...of</code>循环遍历所有的键值对。如果直接用<code>for...of</code>循环遍历 FormData 实例，默认就会调用这个方法。</li>
</ul>
<p>下面是<code>get()</code>、<code>getAll()</code>、<code>set()</code>、<code>append()</code>方法的例子。</p>
<pre><code class="language-javascript">var formData = new FormData();

formData.set('username', '张三');
formData.append('username', '李四');
formData.get('username') // &quot;张三&quot;
formData.getAll('username') // [&quot;张三&quot;, &quot;李四&quot;]

formData.append('userpic[]', myFileInput.files[0], 'user1.jpg');
formData.append('userpic[]', myFileInput.files[1], 'user2.jpg');
</code></pre>
<p>下面是遍历器的例子。</p>
<pre><code class="language-javascript">var formData = new FormData();
formData.append('key1', 'value1');
formData.append('key2', 'value2');

for (var key of formData.keys()) {
  console.log(key);
}
// &quot;key1&quot;
// &quot;key2&quot;

for (var value of formData.values()) {
  console.log(value);
}
// &quot;value1&quot;
// &quot;value2&quot;

for (var pair of formData.entries()) {
  console.log(pair[0] + ': ' + pair[1]);
}
// key1: value1
// key2: value2

// 等同于遍历 formData.entries()
for (var pair of formData) {
  console.log(pair[0] + ': ' + pair[1]);
}
// key1: value1
// key2: value2
</code></pre>
<h2 id="表单的内置验证">表单的内置验证</h2>
<h3 id="自动校验">自动校验</h3>
<p>表单提交的时候，浏览器允许开发者指定一些条件，它会自动验证各个表单控件的值是否符合条件。</p>
<pre><code class="language-html">&lt;!-- 必填 --&gt;
&lt;input required&gt;

&lt;!-- 必须符合正则表达式 --&gt;
&lt;input pattern=&quot;banana|cherry&quot;&gt;

&lt;!-- 字符串长度必须为6个字符 --&gt;
&lt;input minlength=&quot;6&quot; maxlength=&quot;6&quot;&gt;

&lt;!-- 数值必须在1到10之间 --&gt;
&lt;input type=&quot;number&quot; min=&quot;1&quot; max=&quot;10&quot;&gt;

&lt;!-- 必须填入 Email 地址 --&gt;
&lt;input type=&quot;email&quot;&gt;

&lt;!-- 必须填入 URL --&gt;
&lt;input type=&quot;URL&quot;&gt;
</code></pre>
<p>如果一个控件通过验证，它就会匹配<code>:valid</code>的 CSS 伪类，浏览器会继续进行表单提交的流程。如果没有通过验证，该控件就会匹配<code>:invalid</code>的 CSS 伪类，浏览器会终止表单提交，并显示一个错误信息。</p>
<pre><code class="language-css">input:invalid {
  border-color: red;
}
input,
input:valid {
  border-color: #ccc;
}
</code></pre>
<h3 id="checkvalidity">checkValidity()</h3>
<p>除了提交表单的时候，浏览器自动校验表单，还可以手动触发表单的校验。表单元素和表单控件都有<code>checkValidity()</code>方法，用于手动触发校验。</p>
<pre><code class="language-javascript">// 触发整个表单的校验
form.checkValidity()

// 触发单个表单控件的校验
formControl.checkValidity()
</code></pre>
<p><code>checkValidity()</code>方法返回一个布尔值，<code>true</code>表示通过校验，<code>false</code>表示没有通过校验。因此，提交表单可以封装为下面的函数。</p>
<pre><code class="language-javascript">function submitForm(action) {
  var form = document.getElementById('form');
  form.action = action;
  if (form.checkValidity()) {
    form.submit();
  }
}
</code></pre>
<h3 id="willvalidate-属性">willValidate 属性</h3>
<p>控件元素的<code>willValidate</code>属性是一个布尔值，表示该控件是否会在提交时进行校验。</p>
<pre><code class="language-javascript">// HTML 代码如下
// &lt;form novalidate&gt;
//   &lt;input id=&quot;name&quot; name=&quot;name&quot; required /&gt;
// &lt;/form&gt;

var input = document.querySelector('#name');
input.willValidate // true
</code></pre>
<h3 id="validationmessage-属性">validationMessage 属性</h3>
<p>控件元素的<code>validationMessage</code>属性返回一个字符串，表示控件不满足校验条件时，浏览器显示的提示文本。以下两种情况，该属性返回空字符串。</p>
<ul>
<li>该控件不会在提交时自动校验</li>
<li>该控件满足校验条件</li>
</ul>
<pre><code class="language-javascript">// HTML 代码如下
// &lt;form&gt;&lt;input type=&quot;text&quot; required&gt;&lt;/form&gt;
document.querySelector('form input').validationMessage
// &quot;请填写此字段。&quot;
</code></pre>
<p>下面是另一个例子。</p>
<pre><code class="language-javascript">var myInput = document.getElementById('myinput');
if (!myInput.checkValidity()) {
  document.getElementById('prompt').innerHTML = myInput.validationMessage;
}
</code></pre>
<h3 id="setcustomvalidity">setCustomValidity()</h3>
<p>控件元素的<code>setCustomValidity()</code>方法用来定制校验失败时的报错信息。它接受一个字符串作为参数，该字符串就是定制的报错信息。如果参数为空字符串，则上次设置的报错信息被清除。</p>
<p>这个方法可以替换浏览器内置的表单验证报错信息，参数就是要显示的报错信息。</p>
<pre><code class="language-html">&lt;form action=&quot;somefile.php&quot;&gt;
  &lt;input
    type=&quot;text&quot;
    name=&quot;username&quot;
    placeholder=&quot;Username&quot;
    pattern=&quot;[a-z]{1,15}&quot;
    id=&quot;username&quot;
  &gt;
  &lt;input type=&quot;submit&quot;&gt;
&lt;/form&gt;
</code></pre>
<p>上面的表单输入框，要求只能输入小写字母，且不得超过15个字符。如果输入不符合要求（比如输入“ABC”），提交表单的时候，Chrome 浏览器会弹出报错信息“Please match the requested format.”，禁止表单提交。下面使用<code>setCustomValidity()</code>方法替换掉报错信息。</p>
<pre><code class="language-javascript">var input = document.getElementById('username');
input.oninvalid = function (event) {
  event.target.setCustomValidity(
    '用户名必须是小写字母，不能为空，最长不超过15个字符'
  );
}
</code></pre>
<p>上面代码中，<code>setCustomValidity()</code>方法是在<code>invalid</code>事件的监听函数里面调用。该方法也可以直接调用，这时如果参数不为空字符串，浏览器就会认为该控件没有通过校验，就会立刻显示该方法设置的报错信息。</p>
<pre><code class="language-javascript">/* HTML 代码如下
&lt;form&gt;
  &lt;p&gt;&lt;input type=&quot;file&quot; id=&quot;fs&quot;&gt;&lt;/p&gt;
  &lt;p&gt;&lt;input type=&quot;submit&quot;&gt;&lt;/p&gt;
&lt;/form&gt;
*/

document.getElementById('fs').onchange = checkFileSize;

function checkFileSize() {
  var fs = document.getElementById('fs');
  var files = fs.files;
  if (files.length &gt; 0) {
     if (files[0].size &gt; 75 * 1024) {
       fs.setCustomValidity('文件不能大于 75KB');
       return;
     }
  }
  fs.setCustomValidity('');
}
</code></pre>
<p>上面代码一旦发现文件大于 75KB，就会设置校验失败，同时给出自定义的报错信息。然后，点击提交按钮时，就会显示报错信息。这种校验失败是不会自动消除的，所以如果所有文件都符合条件，要将报错信息设为空字符串，手动消除校验失败的状态。</p>
<h3 id="validity-属性">validity 属性</h3>
<p>控件元素的属性<code>validity</code>属性返回一个<code>ValidityState</code>对象，包含当前校验状态的信息。</p>
<p>该对象有以下属性，全部为只读属性。</p>
<ul>
<li><code>ValidityState.badInput</code>：布尔值，表示浏览器是否不能将用户的输入转换成正确的类型，比如用户在数值框里面输入字符串。</li>
<li><code>ValidityState.customError</code>：布尔值，表示是否已经调用<code>setCustomValidity()</code>方法，将校验信息设置为一个非空字符串。</li>
<li><code>ValidityState.patternMismatch</code>：布尔值，表示用户输入的值是否不满足模式的要求。</li>
<li><code>ValidityState.rangeOverflow</code>：布尔值，表示用户输入的值是否大于最大范围。</li>
<li><code>ValidityState.rangeUnderflow</code>：布尔值，表示用户输入的值是否小于最小范围。</li>
<li><code>ValidityState.stepMismatch</code>：布尔值，表示用户输入的值不符合步长的设置（即不能被步长值整除）。</li>
<li><code>ValidityState.tooLong</code>：布尔值，表示用户输入的字数超出了最长字数。</li>
<li><code>ValidityState.tooShort</code>：布尔值，表示用户输入的字符少于最短字数。</li>
<li><code>ValidityState.typeMismatch</code>：布尔值，表示用户填入的值不符合类型要求（主要是类型为 Email 或 URL 的情况）。</li>
<li><code>ValidityState.valid</code>：布尔值，表示用户是否满足所有校验条件。</li>
<li><code>ValidityState.valueMissing</code>：布尔值，表示用户没有填入必填的值。</li>
</ul>
<p>下面是一个例子。</p>
<pre><code class="language-javascript">var input = document.getElementById('myinput');
if (input.validity.valid) {
  console.log('通过校验');
} else {
  console.log('校验失败');
}
</code></pre>
<p>下面是另外一个例子。</p>
<pre><code class="language-javascript">var txt = '';
if (document.getElementById('myInput').validity.rangeOverflow) {
  txt = '数值超过上限';
}
document.getElementById('prompt').innerHTML = txt;
</code></pre>
<p>如果想禁止浏览器弹出表单验证的报错信息，可以监听<code>invalid</code>事件。</p>
<pre><code class="language-javascript">var input = document.getElementById('username');
var form  = document.getElementById('form');

var elem = document.createElement('div');
elem.id  = 'notify';
elem.style.display = 'none';
form.appendChild(elem);

input.addEventListener('invalid', function (event) {
  event.preventDefault();
  if (!event.target.validity.valid) {
    elem.textContent   = '用户名必须是小写字母';
    elem.className     = 'error';
    elem.style.display = 'block';
    input.className    = 'invalid animated shake';
  }
});

input.addEventListener('input', function(event){
  if ( 'block' === elem.style.display ) {
    input.className = '';
    elem.style.display = 'none';
  }
});
</code></pre>
<p>上面代码中，一旦发生<code>invalid</code>事件（表单验证失败），<code>event.preventDefault()</code>用来禁止浏览器弹出默认的验证失败提示，然后设置定制的报错提示框。</p>
<h3 id="表单的-novalidate-属性">表单的 novalidate 属性</h3>
<p>表单元素的 HTML 属性<code>novalidate</code>，可以关闭浏览器的自动校验。</p>
<pre><code class="language-html">&lt;form novalidate&gt;
&lt;/form&gt;
</code></pre>
<p>这个属性也可以在脚本里设置。</p>
<pre><code class="language-javascript">form.noValidate = true;
</code></pre>
<p>如果表单元素没有设置<code>novalidate</code>属性，那么提交按钮（<code>&lt;button&gt;</code>或<code>&lt;input&gt;</code>元素）的<code>formnovalidate</code>属性也有同样的作用。</p>
<pre><code class="language-html">&lt;form&gt;
  &lt;input type=&quot;submit&quot; value=&quot;submit&quot; formnovalidate&gt;
&lt;/form&gt;
</code></pre>
<h2 id="enctype-属性">enctype 属性</h2>
<p>表单能够用四种编码，向服务器发送数据。编码格式由表单的<code>enctype</code>属性决定。</p>
<p>假定表单有两个字段，分别是<code>foo</code>和<code>baz</code>，其中<code>foo</code>字段的值等于<code>bar</code>，<code>baz</code>字段的值是一个分为两行的字符串。</p>
<pre><code>The first line.
The second line.
</code></pre>
<p>下面四种格式，都可以将这个表单发送到服务器。</p>
<p><strong>（1）GET 方法</strong></p>
<p>如果表单使用<code>GET</code>方法发送数据，<code>enctype</code>属性无效。</p>
<pre><code class="language-html">&lt;form
  action=&quot;register.php&quot;
  method=&quot;get&quot;
  onsubmit=&quot;AJAXSubmit(this); return false;&quot;
&gt;
&lt;/form&gt;
</code></pre>
<p>数据将以 URL 的查询字符串发出。</p>
<pre><code class="language-http">?foo=bar&amp;baz=The%20first%20line.%0AThe%20second%20line.
</code></pre>
<p><strong>（2）application/x-www-form-urlencoded</strong></p>
<p>如果表单用<code>POST</code>方法发送数据，并省略<code>enctype</code>属性，那么数据以<code>application/x-www-form-urlencoded</code>格式发送（因为这是默认值）。</p>
<pre><code class="language-html">&lt;form
  action=&quot;register.php&quot;
  method=&quot;post&quot;
  onsubmit=&quot;AJAXSubmit(this); return false;&quot;
&gt;
&lt;/form&gt;
</code></pre>
<p>发送的 HTTP 请求如下。</p>
<pre><code class="language-http">Content-Type: application/x-www-form-urlencoded

foo=bar&amp;baz=The+first+line.%0D%0AThe+second+line.%0D%0A
</code></pre>
<p>上面代码中，数据体里面的<code>%0D%0A</code>代表换行符（<code>\r\n</code>）。</p>
<p><strong>（3）text/plain</strong></p>
<p>如果表单使用<code>POST</code>方法发送数据，<code>enctype</code>属性为<code>text/plain</code>，那么数据将以纯文本格式发送。</p>
<pre><code class="language-html">&lt;form
  action=&quot;register.php&quot;
  method=&quot;post&quot;
  enctype=&quot;text/plain&quot;
  onsubmit=&quot;AJAXSubmit(this); return false;&quot;
&gt;
&lt;/form&gt;
</code></pre>
<p>发送的 HTTP 请求如下。</p>
<pre><code class="language-http">Content-Type: text/plain

foo=bar
baz=The first line.
The second line.
</code></pre>
<p><strong>（4）multipart/form-data</strong></p>
<p>如果表单使用<code>POST</code>方法，<code>enctype</code>属性为<code>multipart/form-data</code>，那么数据将以混合的格式发送。</p>
<pre><code class="language-html">&lt;form
  action=&quot;register.php&quot;
  method=&quot;post&quot;
  enctype=&quot;multipart/form-data&quot;
  onsubmit=&quot;AJAXSubmit(this); return false;&quot;
&gt;
&lt;/form&gt;
</code></pre>
<p>发送的 HTTP 请求如下。</p>
<pre><code class="language-http">Content-Type: multipart/form-data; boundary=---------------------------314911788813839

-----------------------------314911788813839
Content-Disposition: form-data; name=&quot;foo&quot;

bar
-----------------------------314911788813839
Content-Disposition: form-data; name=&quot;baz&quot;

The first line.
The second line.

-----------------------------314911788813839--
</code></pre>
<p>这种格式也是文件上传的格式。</p>
<h2 id="文件上传">文件上传</h2>
<p>用户上传文件，也是通过表单。具体来说，就是通过文件输入框选择本地文件，提交表单的时候，浏览器就会把这个文件发送到服务器。</p>
<pre><code class="language-html">&lt;input type=&quot;file&quot; id=&quot;file&quot; name=&quot;myFile&quot;&gt;
</code></pre>
<p>此外，还需要将表单<code>&lt;form&gt;</code>元素的<code>method</code>属性设为<code>POST</code>，<code>enctype</code>属性设为<code>multipart/form-data</code>。其中，<code>enctype</code>属性决定了 HTTP 头信息的<code>Content-Type</code>字段的值，默认情况下这个字段的值是<code>application/x-www-form-urlencoded</code>，但是文件上传的时候要改成<code>multipart/form-data</code>。</p>
<pre><code class="language-html">&lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
  &lt;div&gt;
    &lt;label for=&quot;file&quot;&gt;选择一个文件&lt;/label&gt;
    &lt;input type=&quot;file&quot; id=&quot;file&quot; name=&quot;myFile&quot; multiple&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;input type=&quot;submit&quot; id=&quot;submit&quot; name=&quot;submit_button&quot; value=&quot;上传&quot; /&gt;
  &lt;/div&gt;
&lt;/form&gt;
</code></pre>
<p>上面的 HTML 代码中，file 控件的<code>multiple</code>属性，指定可以一次选择多个文件；如果没有这个属性，则一次只能选择一个文件。</p>
<pre><code class="language-javascript">var fileSelect = document.getElementById('file');
var files = fileSelect.files;
</code></pre>
<p>然后，新建一个 FormData 实例对象，模拟发送到服务器的表单数据，把选中的文件添加到这个对象上面。</p>
<pre><code class="language-javascript">var formData = new FormData();

for (var i = 0; i &lt; files.length; i++) {
  var file = files[i];

  // 只上传图片文件
  if (!file.type.match('image.*')) {
    continue;
  }

  formData.append('photos[]', file, file.name);
}
</code></pre>
<p>最后，使用 Ajax 向服务器上传文件。</p>
<pre><code class="language-javascript">var xhr = new XMLHttpRequest();

xhr.open('POST', 'handler.php', true);

xhr.onload = function () {
  if (xhr.status !== 200) {
    console.log('An error occurred!');
  }
};

xhr.send(formData);
</code></pre>
<p>除了发送 FormData 实例，也可以直接 AJAX 发送文件。</p>
<pre><code class="language-javascript">var file = document.getElementById('test-input').files[0];
var xhr = new XMLHttpRequest();

xhr.open('POST', 'myserver/uploads');
xhr.setRequestHeader('Content-Type', file.type);
xhr.send(file);
</code></pre>
<h2 id="参考链接">参考链接</h2>
<ul>
<li><a href="https://webdesign.tutsplus.com/tutorials/html5-form-validation-with-the-pattern-attribute--cms-25145">HTML5 Form Validation With the “pattern” Attribute</a>, Thoriq Firdaus</li>
</ul>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://0520.eu.org/post/javascript-bom-file/" class="post-title gt-a-link">
                    JavaScript 教程-浏览器模型-File 对象，FileList 对象，FileReader 对象
                </a>
            </div>
        

        

        
            

            
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/disqusjs/dist/disqusjs.css">
<script src="https://cdn.jsdelivr.net/npm/disqusjs/dist/disqus.js"></script>

<div id="disqus_thread"></div>

<script>

var options = {
  shortname: '0520',
  apikey: '',
}
if ('https://0520.disqus.com') {
  options.api = 'https://0520.disqus.com'
}
var dsqjs = new DisqusJS(options)

</script>

            
        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first"></div>
    <div class="social-container">
        
            
                <a href="https://github.com/lovoupw" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
                <a href="https://twitter.com/lovou_pw" target="_blank">
                    <i class="fab fa-twitter gt-c-content-color-first"></i>
                </a>
            
        
            
                <a href="https://weibo.com/316302888" target="_blank">
                    <i class="fab fa-weibo gt-c-content-color-first"></i>
                </a>
            
        
            
                <a href="https://zhihu.com/people/feng-ling-71-63-43" target="_blank">
                    <i class="fab fa-zhihu gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Copyright &copy;2024 负重前行 <a href="https://blog.lovou.pw" target="_blank">O52O</a> 加油吧少年
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://0520.eu.org/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
